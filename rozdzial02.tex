\chapter{Praca z szablonem}
\section{Struktura projektu}
Pisząc pracę w systemie LaTeX zwykle przyjmuje się jakąś konwencję co do nazewnictwa tworzonych plików, ich położenia oraz powiązań. Przygotowując niniejszy szablon założono, że projekt będzie się składał z pliku głównego, plików z kodem kolejnych rozdziałów i dodatków (włączanych do kompilacji w dokumencie głównym), katalogów z plikami grafik (o nazwach wskazujących na rozdziały, w których grafiki te zostaną wstawione), pliku ze skrótami (opcjonalny), pliku z danymi bibliograficznymi (plik \texttt{dokumentacja.bib}). Taki ,,układ'' zapewnia porządek oraz pozwala na selektywną kompilację rozdziałów. 

Przyjętą konwencję da się opisać jak następuje:
\begin{itemize}
\item Plikiem głównym jest plik \texttt{Dyplom.tex}. To w nim znajdują się deklaracje wszystkich używanych styli, definicje makr oraz ustawień, jak również polecenie \verb+\begin{document}+. 
\item Teksty redagowane są w osobnych plikach. Pliki te zamieszczone są w katalogu głównym (tym samym, co plik \texttt{Dyplom.tex}).
\item W pliku \texttt{streszczenie.tex} powinien pojawić się tekst streszczenia ze słowami kluczowymi (tekst ten oraz słowa kluczowe będzie można wykorzystać do wypełnienia formularzy pojawiających się podczas wysyłania pracy do analizy antyplagiatowej w systemie ASAP)
\item Plik \texttt{skroty.tex} powinien zawierać wykaz użytych skrótów. Jeśli w pracy nie stosuje się skrótów czy akronimów lub ich liczba jest nieznaczna, wtedy należy zrezygnować z tego pliku. 
\item Tekst kolejnych rozdziałów powinien pojawić się w plikach o nazwach zawierających numery tych rozdziałów. Według przyjętej konwencji \texttt{rozdzial01.tex} to plik pierwszego rozdziału (ze Wstępem), \texttt{rozdzial02.tex} to plik z treścią drugiego rozdziału itd. 
\item Teksty dodatków mają być redagowane w osobnych plikach o nazwach zawierających literę dodatku. Pliki te, podobnie do plików z tekstem rozdziałów, zamieszczane są w katalogu głównym. I~tak \texttt{dodatekA.tex} oraz \texttt{dodatekB.tex} to, odpowiednio, pliki z treścią dodatku A oraz dodatku B.
\item Każdemu rozdziałowi i dodatkowi towarzyszy katalog przeznaczony do składowania dołączanych w nim grafik. I tak \texttt{rys01} to katalog na pliki z grafikami dołączanymi do rozdziału pierwszego, \texttt{rys02} to katalog na pliki z grafikami dołączanymi do rozdziału drugiego itd.
Podobnie \texttt{rysA} to katalog na pliki z grafikami dołączanymi w dodatku A itd.
\item W katalogu głównym zamieszczany jest plik \texttt{dokumentacja.bib} zawierający bazę danych bibliograficznych.
\item Jeśli praca nad dokumentem odbywa się w \texttt{TeXnicCenter}, to środowisko to wymusza konieczność podania pliku projektu (plik projektu to coś na styl pliku z definicją solucji). Plikiem projektu, który umieszczono w szablonie jest \texttt{Dyplom.tcp}. Generalnie plik projektu nie jest wymagany do latexowej kompilacji. Niemniej pozwala zapamiętać ustawienia środowiska (w tym ustawienia językowe potrzebne do sprawdzania poprawności wyrazów -- patrz następny podrozdział).  
\end{itemize}

\begin{table}[htb]
\centering\small
\caption{Pliki źródłowe szablonu oraz wyniki kompilacji}
\label{tab:szablon}
\begin{tabularx}{\linewidth}{|p{.55\linewidth}|X|}\hline
Źródła & Wyniki kompilacji \\ \hline\hline
\verb?Dokument.tex? - dokument główny\newline
\verb?Dokument.tcp? -- plik projektu TeXnicCenter (opcjonalny)\newline
\verb?streszczenie.tex? -- plik streszczenia\newline
\verb?skroty.tex? -- plik ze skrótami\newline
\verb?rozdzial01.tex? -- plik rozdziału \texttt{01}\newline
\verb?...?\newline
\verb?dodatekA.tex? -- plik dodatku \texttt{A}\newline
\verb?...?\newline
\verb?rys01? -- katalog na rysunki do rozdziału \texttt{01}\newline
\verb?   |- fig01.png? -- plik grafiki\newline
\verb?   |- ...?\newline
\verb?...?\newline
\verb?rysA? -- katalog na rysunki do dodatku \texttt{A}\newline
\verb?   |- fig01.png? -- plik grafiki\newline
\verb?   |- ...?\newline
\verb?...?\newline
\verb?dokumentacja.bib? -- plik danych bibliograficznych\newline
\verb?Dyplom.ist? -- plik ze stylem indeksu\newline
\verb?by-nc-sa.png? -- plik z ikonami CC\newline
 &
\verb?Dyplom.bbl?\newline
\verb?Dyplom.blg?\newline
\verb?Dyplom.ind?\newline
\verb?Dyplom.idx?\newline
\verb?Dyplom.lof?\newline
\verb?Dyplom.log?\newline
\verb?Dyplom.lot?\newline
\verb?Dyplom.out?\newline
\verb?Dyplom.pdf? -- dokument wynikowy\newline
\verb?Dyplom.syntex?\newline
\verb?Dyplom.toc?\newline
\verb?Dyplom.tps?\newline
\verb?*.aux?\newline 
\verb?Dyplom.synctex?\newline\\
\hline
\end{tabularx}
\end{table}

\section{Kodowanie znaków}
System LaTeX obsługuje wielojęzyczność. Można tworzyć w nim dokumenty z tekstem zawierającym różne znaki diakrytyczne. 
Należy jednak zdawać sobie sprawę, w jaki sposób znaki te są obsługiwane. Otóż na kodowanie znaków należy patrzeć z dwóch perspektyw: perspektywy edytowania kodu latexowego oraz perspektywy kodowania dokumentu wynikowego i użytych czcionek.

Kod latexowy może być edytowany w dowolnym tekstowym edytorze. Zastosowane kodowanie znaków w tym edytorze musi być znane latexowi, inaczej kompilacja tego kodu się nie powiedzie. Informację o tym kodowaniu przekazuje się w opcjach pakietu \texttt{inputenc}. Niniejszy szablon przygotowano w systemie Windows, a latexowe źródła umieszczono w plikach ANSI z użyciem strony kodowej cp1250. Dlatego w poleceniu \verb+\usepackage[cp1250]{inputenc}+ jako opcję wpisano \texttt{cp1250}.


Szablon można wykorzystać również przy innych kodowaniach i w innych systemach. Jednak wtedy konieczna będzie korekta dokumentu \texttt{Dyplom.tex} odpowiednio do wybranego przypadku. Korekta ta polegać ma na zamianie polecenia \verb+\usepackage[cp1250]{inputenc}+  na polecenie \verb+\usepackage[utf8]{inputenc}+ oraz konwersji znaków i zmiany kodowania istniejących plików ze źródłem latexowego kodu (plików o rozszerzeniu \texttt{*.tex} oraz \texttt{*.bib}).

Kodowanie znaków jest istotne również przy edytowaniu bazy danych bibliograficznych (pliku \texttt{dokumentacja.bib}). Aby \texttt{bibtex} poprawnie interpretował polskie znaki plik \texttt{dokumentacja.bib} powinien być zakodowany w ANSI, CR+LF (dla ustawień jak w szablonie). 
W szczególności, jeśli ominąć chce się problem kodowania, polskie znaki w bazie danych bibliograficznych można zastąpić odpowiednią notacją: \verb|\k{a}| \verb|\'c| \verb|\k{e}| \verb|\l{}| \verb|\'n| \verb|\'o| \verb|\'s| \verb|\'z| \verb|\.z| \verb|\k{A}| \verb|\'C| \verb|\k{E}| \verb|\L{}| \verb|\'N| \verb|\'O| \verb|\'S| \verb|\'Z| \verb|\.Z|. 

Samo kodowanie plików może być źródłem paru problemów. Chodzi o to, że użytkownicy pracujący z edytorami tekstów pod linuxem mogą generować pliki zakodowane w UTF-8 bez BOM (lub z BOM -- co nie jest zalecane), a pod windowsem -- pliki ANSI ze znakami ze strony kodewej \texttt{cp1250}. A z takimi plikami różne edytory różnie sobie radzą. W szczególności edytor TeXnicCenter podczas otwierania plików może potraktować jego zawartość jako UTF8 lub ANSI -- prawdopodobnie interpretuje z jakim kodowaniem ma do czynienia na podstawie obecności w pliku znaków specjalnych. Bywa, że choć wszystko w TeXnicCenter wygląda OK, to jednak kompilacja latexowa ,,nie idzie''. Problemem mogą być właśnie pierwsze bajty, których nie widać w edytorze. 

Do konwersji kodowania można użyć Notepad++ (jest tam opcja ,,konwertuj'' - nie mylić z opcją ,,koduj'', która przekodowuje znaki, jednak nie zmienia sposobu kodowania pliku).

Jeśli chodzi o drugą perspektywę, tj.\ kodowanie znaków w dokumencie wynikowym, to sprawa jest bardziej skomplikowana. Wiąże się z nią zarządzanie czcionkami, definiowanie mapowania itp. Szablon przygotowano tak, by wynikowy dokument zawierał polskie znaki diakrytyczne, które nie są zlepkami literki i ogonka.

\section{Kompilacja szablonu}
Kompilację szablonu można uruchamiać na kilka różnych sposobów. Wszystko zależy od używanego systemu operacyjnego, zainstalowanej na nim dystrybucji latexa oraz dostępnych narzędzi. Zazwyczaj kompilację rozpoczyna się wydając polecenie z linii komend lub uruchamia się ją za pomocą narzędzi zintegrowanych środowisk.

Kompilacja z linii komend polega na uruchomieniu w katalogu, w którym rozpakowano źródła szablonu, następującego polecenia:
\begin{lstlisting}[basicstyle=\ttfamily]
> pdflatex Dyplom.tex
\end{lstlisting}
gdzie \texttt{pdflatex} to nazwa kompilatora, zaś \texttt{Dyplom.tex} to nazwa głównego pliku redagowanej pracy. 
W przypadku korzystania ze środowiska \texttt{TeXnicCenter} należy otworzyć dostarczony w szablonie plik projektu \texttt{Dyplom.tcp}, a następnie uruchomić kompilację narzędziami dostępnymi w pasku narzędziowym.

Aby poprawnie wygenerowały się wszystkie referencje (spis treści, odwołania do tabel, rysunków, pozycji literaturowych, równań itd.) kompilację \texttt{pdflatex} należy wykonać dwukrotnie, a~czasem nawet trzykrotnie. Wynika to z konieczności zapamiętywania wyników kompilacji i ich wykorzystywania w kolejnych przebiegach. Tak dzieje się przy generowaniu odwołań do pozycji literaturowych oraz tworzeniu wykazu literatury). 

Wygenerowanie danych bibliograficznych zapewnia kompilacja \texttt{bibtex} uruchamiana po kompilacji \texttt{pdfltex}. Można to zrobić z linii komend:
\begin{lstlisting}[basicstyle=\ttfamily]
> bibtex Dyplom
\end{lstlisting}
lub wybierając odpowiednią pozycję z paska narzędziowego wykorzystywanego środowiska. Po kompilacji za pomocą \texttt{bibtex} na dysku pojawi się plik \texttt{Dyplom.bbl}. Dopiero po kolejnych dwóch kompilacjach \texttt{pdflatex} dane z tego pliku zostaną odpowiednio przetworzone i zrenderowane w wygenerowanym dokumencie. Tak więc po każdym wstawieniu nowego cytowania w kodzie dokumentu uzyskanie poprawnego formatowania dokumentu wynikowego wymaga powtórzenia następującej sekwencji kroków kompilacji:
\begin{lstlisting}[basicstyle=\ttfamily]
> pdflatex Document.tex
> bibtex Document
> latex Document.tex
> latex Document.tex
\end{lstlisting}
Szczegóły dotyczące przygotowania danych bibliograficznych oraz zastosowania cytowań przedstawiono w podrozdziale \ref{sec:literatura}.

W głównym pliku zamieszczono polecenia pozwalające sterować procesem kompilacji poprzez włączanie bądź wyłączanie kodu źródłowego poszczególnych rozdziałów. Włączanie kodu do kompilacji zapewniają instrukcje \verb+\include+ oraz \verb+\includeonly+. Pierwsza z nich pozwala włączyć do kompilacji kod wskazanego pliku (np.\ kodu źródłowego pierwszego rozdziału \verb+\include{rozdzial01.tex}+). Druga, jeśli zostanie zastosowana, pozwala określić, które z~plików zostaną skompilowane w całości (na przykład kod źródłowy pierwszego i drugiego rozdziału \verb+\includeonly{rozdzial01.tex,rozdzial02.tex}+). Brak nazwy pliku na liście w poleceniu \verb+\includeonly+ przy jednoczesnym wystąpieniu jego nazwy w poleceniu \verb+\include+ oznacza, że w kompilacji zostaną uwzględnione referencje wygenerowane dla tego pliku wcześniej, sam zaś kod źródłowy pliku nie będzie kompilowany. 

W szablonie wykorzystano klasę dokumentu \texttt{memoir} oraz wybrane pakiety. Podczas kompilacji szablonu w \texttt{MikTeXu} wszelkie potrzebne pakiety zostaną zainstalowane automatycznie (jeśli \texttt{MikTeX} zainstalowano z opcją dynamicznej instalacji brakujących pakietów). W przypadku innych dystrybucji latexowych może okazać się, że pakiety te trzeba doinstalować ręcznie (np.\ pod linuxem z \texttt{TeXLive} trzeba doinstalować dodatkową zbiorczą paczkę, a jeśli ma się menadżera pakietów latexowych, to pakiety latexowe można instalować indywidualnie).

Jeśli w szablonie będzie wykorzystany indeks rzeczowy, kompilację źródeł trzeba będzie rozszerzyć o kroki potrzebne na wygenerowanie plików pośrednich \texttt{Dokument.idx} oraz \texttt{Dokument.ind} oraz dołączenia ich do finalnego dokumentu (podobnie jak to ma miejsce przy generowaniu wykazu literatury).
Szczegóły dotyczące generowania indeksu rzeczowego opisano w podrozdziale~\ref{sec:indeks}.

\section{Sprawdzanie poprawności tekstu}
Większość środowisk ułatwiających pisanie latexowych dokumentów wspiera sprawdzenie poprawności tekstu (ang.~\emph{spell checking}). Wystarczy odpowiednio je skonfigurować. Niestety, proponowana przez narzędzia korekta nie jest genialna. Bazuje ona na prostym porównywaniu wyrazów (z końcówkami). Nie wbudowano w nią żadnej większej inteligencji. Tak więc proszę nie porównywać jej z korektą oferowaną w narzędziach MS Office (tam jest ona dużo bardziej zaawansowana).

TeXnicCenter korzysta ze słowników do pobrania ze strony openoffice (\url{https://extensions.openoffice.org/}).
Aby sprawę uprościć słowniki dla języka polskiego (pliki \texttt{pl\_PL.aff} oraz \texttt{pl\_PL.dic}) dołączono do szablonu (są w katalogu \texttt{Dictionaries}). Pliki te należy umieścić w katalogu \texttt{C:\\Program Files\\TeXnicCenter\\Dictionaries}, a w konfiguracji projektu (Tools/Options/Spelling należy wybrać \texttt{Language: pl}, \texttt{Dialect: PL}. Jeśli główny tekst pracy pisany jest w innym języku, to trzeba zmienić słownik.

Zaskakujące może jest to, że \emph{spell checker} w TeXnicCenter działa zarówno przy pracy na plikach UTF-8, jak i na plikach ANSI. Jeśli byłyby jakieś problemy ze słownikiem wynikające z kodowania znaków, wtedy słownik trzeba przekodować. To powinno pomóc.

\section{Wersjonowanie}
W trakcie edytowania pracy w systemie latex dobrą praktyką jest wersjonowanie tworzonego kodu. 
Do wersjonowania zaleca się wykorzystać system git. Opis sposobu pracy z tym systemem opisano w licznych tutorialach dostępnych w sieci. Szczególnie godnym polecenia zasobem jest strona domowa projektu \url{https://git-scm.com/}.

Zwykle pracę z gitem rozpoczyna się od utworzenia repozytorium zdalnego i lokalnego. Lokalne służy do bieżącej pracy, zdalne -- do współpracy z innymi użytkownikami (z promotorem). 

Po utworzeniu repozytorium lokalnego i jego gałęzi (czy będzie to master czy inna gałąź -- wszystko zależy od ustaleń między zainteresowanymi) należy skopiować do niego wszystkie pliki dostarczone w szablonie, a po ich wstępnym przeredagowaniu należy je zaznaczyć do wersjonowania. Potem należy wysłać zmiany na repozytorium zdalne (możliwa jest też ścieżka odwrotna - można zacząć od zmian na repozytorium zdalnym, które pobrane będą do repozytorium lokanego).

Podczas kompilowania projektu będą powstawały pliki pomocnicze. Plików tych nie należy wersjonować (zabierają niepotrzebnie miejsce, a przecież zawsze można je odtworzyć uruchamiając kompilację na źródłach). Git posiada mechanizm automatycznego odrzucania plików niepodlegających wersjonowaniu. Mechanizm ten bazuje na wykorzystaniu pliku konfiguracyjnego \texttt{.gitignore} zamieszczonego w katalogu głównym repozytorium. O szczegółach \texttt{.gitignore} można poczytać  na stronie \url{https://git-scm.com/docs/gitignore}. 

W sieci można znaleźć liczne propozycje plików konfiguracyjnych \texttt{.gitignore} dopasowanych do potrzeb latexowej kompilacji. Nie trzeba ich jednak szukać. Aby sprawę uprościć w szablonie zamieszczono specjalnie spreparowany taki plik. Zawiera on, między innymi, wpis mówiący o tym, by nie wersjonować pliku wynikowego \texttt{Dyplom.pdf}. Plik ten należy umieścić w repozytorium zaraz po jego utworzeniu. 


Jeśli w repozytorium pojawiły się już jakieś zmiany zanim do niego wstawiono \texttt{.gitignore}, to wtedy należy wykonać ktokroki opisane na stronie: \url{https://stackoverflow.com/questions/38450276/force-git-to-update-gitignore/38451183}

\begin{lstlisting}[basicstyle=\small\ttfamily]
> > > > You will have to clear the existing git cache first.
    git rm -r --cached .
> > > > Once you clear the existing cache, adds/stages all of the files in the current directory and commit
    git add .
    git commit -m "Suitable Message"
> > > > 
\end{lstlisting}


Zalecany schemat współpracy dyplomanta z promotorem polega na wykonywaniu w kolejnych iteracjach następujących kroków:
\begin{itemize}
\item dyplomant edytuje wybraną część pracy, a po skończeniu edycji wrzuca zmiany do zdalnego repozytorium.
\item dyplomant informuje promotora o zakończeniu etapu prac
\item dyplomant może zacząć edycję kolejnego fragmentu pracy, a w tym czasie promotor może dokonać oceny/korekty zmian pobranych ze zdalnego repozytorium
\item promotor wrzuca dokonane przez siebie zmiany do zdalnego repozytorium, informując o tym dyplomanta\
\end{itemize}
Główna zasada tego schematu polega na niedoprowadzaniu do konfliktów (nadpisywanie się zmian). Jeśli jednak takie konflikty nastąpią, można je niwelować poprzez odpowiednie merdżowanie. 

Do wzajemnego informowania można wykorzystać pocztę elektroniczną. Można też spróbować wdrożyć mechanizm zatwierdzania zmian (ang.~\emph{merge requests}). Można też umówić się na sprawdzanie zawartości repozytorium zgodnie z jakimś przyjętym harmonogramem. Ważne, by wiadomo było obu stronom, na jakim schemacie współpracy mają bazować.

Dobrą praktyką jest też wstawianie w kod komentarzy. Przyjętą powszechnie konwencją jest rozpoczynanie komentarzy od:
\begin{itemize}
\item \verb|% TO DO: tekst zalecenia| 
-- jeśli jest to jakieś zalecenie promotora, czy też 
\item \verb|% DONE: tekst wyjaśnienia| 
-- jeśli jakieś zalecenie zostało wykonane przez dyplomanta. 
\end{itemize}

Jako zdalne repozytorium można wykorzystać: github, bitbucket, gitlab (są to serwisy, które pozwalają zarządzać repozytoriami git).
Dobrą praktyką jest też uruchomienie klientów git oferujących graficzny interfejs (jak SourceTree, GitCracken itp.). W narzędziach tych można zobaczyć natychmiast na czym polegały wprowadzone w repozytorium zmiany. 